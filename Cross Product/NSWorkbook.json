{
    "contentVersion": "1.0.0.0",
    "parameters": {
      "workbookDisplayName": {
        "type": "string",
        "defaultValue": "Azure Network Security",
        "metadata": {
          "description": "The friendly name for the workbook that is used in the Gallery or Saved List.  This name must be unique within a resource group."
        }
      },
      "workbookType": {
        "type": "string",
        "defaultValue": "sentinel",
        "metadata": {
          "description": "The gallery that the workbook will been shown under. Supported values include workbook, tsg, etc. Usually, this is 'workbook'"
        }
      },
      "workbookSourceId": {
        "type": "string",
        "defaultValue": "/subscriptions/6b1ceacd-5731-4780-8f96-2078dd96fd96/resourcegroups/soc-ns/providers/microsoft.operationalinsights/workspaces/soc-ns-logs",
        "metadata": {
          "description": "The id of resource instance to which the workbook will be associated"
        }
      },
      "workbookId": {
        "type": "string",
        "defaultValue": "[newGuid()]",
        "metadata": {
          "description": "The unique guid for this workbook instance"
        }
      }
    },
    "resources": [
      {
        "name": "[parameters('workbookId')]",
        "type": "microsoft.insights/workbooks",
        "location": "[resourceGroup().location]",
        "apiVersion": "2018-06-17-preview",
        "dependsOn": [],
        "kind": "shared",
        "properties": {
          "displayName": "[parameters('workbookDisplayName')]",
          "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":\"{\\\"json\\\":\\\"## Azure Network Security\\\\n---\\\\n\\\\nCentral monitoring of relevant Azure network security sources, including Azure Firewall, WAF, and DDoS Protection.\\\"}\",\"name\":\"text - 2\"},{\"type\":9,\"content\":\"{\\\"version\\\":\\\"KqlParameterItem/1.0\\\",\\\"parameters\\\":[{\\\"id\\\":\\\"bcaab627-69e6-4b81-aae6-a88da13501a4\\\",\\\"version\\\":\\\"KqlParameterItem/1.0\\\",\\\"name\\\":\\\"Range\\\",\\\"label\\\":\\\"Time Range\\\",\\\"type\\\":4,\\\"description\\\":\\\"Default range is 1 day.\\\",\\\"value\\\":{\\\"durationMs\\\":604800000},\\\"typeSettings\\\":{\\\"selectableValues\\\":[{\\\"durationMs\\\":300000},{\\\"durationMs\\\":900000},{\\\"durationMs\\\":1800000},{\\\"durationMs\\\":3600000},{\\\"durationMs\\\":14400000},{\\\"durationMs\\\":43200000},{\\\"durationMs\\\":86400000},{\\\"durationMs\\\":172800000},{\\\"durationMs\\\":259200000},{\\\"durationMs\\\":604800000},{\\\"durationMs\\\":1209600000},{\\\"durationMs\\\":2419200000},{\\\"durationMs\\\":2592000000},{\\\"durationMs\\\":5184000000},{\\\"durationMs\\\":7776000000}],\\\"allowCustom\\\":true}}],\\\"style\\\":\\\"pills\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\"}\",\"name\":\"parameters - 2\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"AzureDiagnostics\\\\n| where ResourceType == \\\\\\\"FRONTDOORS\\\\\\\" and Category == \\\\\\\"FrontdoorWebApplicationFirewallLog\\\\\\\"\\\\n| where action_s == \\\\\\\"Block\\\\\\\"\\\\n| summarize Count=count() by Attacker=clientIP_s,Rule=ruleName_s\\\\n| top 10 by Count desc \\\",\\\"size\\\":1,\\\"title\\\":\\\"Front Door WAF block count by Source IP and Rule\\\",\\\"noDataMessage\\\":\\\"No Front Door WAF activity\\\",\\\"timeContext\\\":{\\\"durationMs\\\":2592000000},\\\"exportToExcelOptions\\\":\\\"visible\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"categoricalbar\\\",\\\"tileSettings\\\":{\\\"showBorder\\\":false,\\\"titleContent\\\":{\\\"columnMatch\\\":\\\"Attacker\\\",\\\"formatter\\\":1},\\\"leftContent\\\":{\\\"columnMatch\\\":\\\"Count\\\",\\\"formatter\\\":12,\\\"formatOptions\\\":{\\\"palette\\\":\\\"auto\\\"},\\\"numberFormat\\\":{\\\"unit\\\":17,\\\"options\\\":{\\\"maximumSignificantDigits\\\":3,\\\"maximumFractionDigits\\\":2}}}},\\\"graphSettings\\\":{\\\"type\\\":2,\\\"topContent\\\":{\\\"columnMatch\\\":\\\"Attacker\\\",\\\"formatter\\\":1,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},\\\"leftContent\\\":{\\\"columnMatch\\\":\\\"Rule\\\",\\\"formatOptions\\\":{\\\"showIcon\\\":true}},\\\"centerContent\\\":{\\\"columnMatch\\\":\\\"Count\\\",\\\"formatter\\\":1,\\\"formatOptions\\\":{\\\"showIcon\\\":true},\\\"numberFormat\\\":{\\\"unit\\\":17,\\\"options\\\":{\\\"maximumSignificantDigits\\\":3,\\\"maximumFractionDigits\\\":2}}},\\\"hivesContent\\\":{\\\"columnMatch\\\":\\\"Rule\\\",\\\"formatter\\\":1,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},\\\"nodeIdField\\\":\\\"Attacker\\\",\\\"nodeSize\\\":null,\\\"staticNodeSize\\\":300,\\\"colorSettings\\\":{\\\"nodeColorField\\\":\\\"Attacker\\\",\\\"type\\\":4,\\\"heatmapPalette\\\":\\\"coldHot\\\",\\\"heatmapMin\\\":null,\\\"heatmapMax\\\":null},\\\"groupByField\\\":\\\"Rule\\\",\\\"hivesMargin\\\":5},\\\"chartSettings\\\":{\\\"xAxis\\\":\\\"Attacker\\\",\\\"group\\\":\\\"Rule\\\",\\\"createOtherGroup\\\":null,\\\"showLegend\\\":true,\\\"xSettings\\\":{\\\"unit\\\":17,\\\"min\\\":null,\\\"max\\\":null}},\\\"mapSettings\\\":{\\\"latitude\\\":\\\"latitude\\\",\\\"longitude\\\":\\\"longitude\\\"}}\",\"name\":\"query - 2\"}],\"isLocked\":false,\"styleSettings\":{},\"fromTemplateId\":\"sentinel-UserWorkbook\"}",
          "version": "1.0",
          "sourceId": "[parameters('workbookSourceId')]",
          "category": "[parameters('workbookType')]"
        }
      }
    ],
    "outputs": {
      "workbookId": {
        "type": "string",
        "value": "[resourceId( 'microsoft.insights/workbooks', parameters('workbookId'))]"
      }
    },
    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#"
  }